<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¥½å¤©è¨¼åˆ¸å¯¾å¿œ è³‡ç”£ç®¡ç†ï¼†æ±ºç®—ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Noto Sans JP', 'sans-serif'] },
        }
      }
    }
  </script>
  <style>
    body { font-family: 'Noto Sans JP', sans-serif; }
    .drag-active { border-color: #3B82F6 !important; background-color: #EFF6FF !important; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ========== æ±ºç®—æ—¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ==========
    const US_EARNINGS = {
      'AAPL': { name: 'ã‚¢ãƒƒãƒ—ãƒ«', nextEarnings: '2026-01-30', time: 'AMC' },
      'MSFT': { name: 'ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆ', nextEarnings: '2026-01-28', time: 'AMC' },
      'GOOGL': { name: 'ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ', nextEarnings: '2026-02-04', time: 'AMC' },
      'AMZN': { name: 'ã‚¢ãƒã‚¾ãƒ³', nextEarnings: '2026-02-06', time: 'AMC' },
      'NVDA': { name: 'ã‚¨ãƒŒãƒ“ãƒ‡ã‚£ã‚¢', nextEarnings: '2026-02-26', time: 'AMC' },
      'META': { name: 'ãƒ¡ã‚¿', nextEarnings: '2026-01-29', time: 'AMC' },
      'TSLA': { name: 'ãƒ†ã‚¹ãƒ©', nextEarnings: '2026-01-29', time: 'AMC' },
      'NFLX': { name: 'ãƒãƒƒãƒˆãƒ•ãƒªãƒƒã‚¯ã‚¹', nextEarnings: '2026-01-21', time: 'AMC' },
      'LLY': { name: 'ã‚¤ãƒ¼ãƒ©ã‚¤ãƒªãƒªãƒ¼', nextEarnings: '2026-02-06', time: 'BMO' },
      'V': { name: 'ãƒ“ã‚¶', nextEarnings: '2026-01-30', time: 'AMC' },
      'TSM': { name: 'TSMC', nextEarnings: '2026-01-16', time: 'BMO' },
      'PLTR': { name: 'ãƒ‘ãƒ©ãƒ³ãƒ†ã‚£ã‚¢', nextEarnings: '2026-02-03', time: 'AMC' },
      'KO': { name: 'ã‚³ã‚«ãƒ»ã‚³ãƒ¼ãƒ©', nextEarnings: '2026-02-11', time: 'BMO' },
      'SOFI': { name: 'ã‚½ãƒ¼ãƒ•ã‚¡ã‚¤', nextEarnings: '2026-01-27', time: 'AMC' },
      'IONQ': { name: 'IonQ', nextEarnings: '2026-03-12', time: 'AMC' },
      'BRK B': { name: 'ãƒãƒ¼ã‚¯ã‚·ãƒ£ãƒ¼', nextEarnings: '2026-02-22', time: 'BMO' },
      'ACHR': { name: 'ã‚¢ãƒ¼ãƒãƒ£ãƒ¼', nextEarnings: '2026-02-27', time: 'AMC' },
    };

    const JP_EARNINGS = {
      '1306': { name: 'TOPIX ETF', nextEarnings: null, time: null },
      '1542': { name: 'ç´”éŠ€ä¸Šå ´ä¿¡è¨—', nextEarnings: null, time: null },
      '1591': { name: 'JPX400 ETF', nextEarnings: null, time: null },
      '8985': { name: 'ã‚¸ãƒ£ãƒ‘ãƒ³ãƒ»ãƒ›ãƒ†ãƒ«ãƒ»ãƒªãƒ¼ãƒˆ', nextEarnings: '2026-02-20', time: 'JP' },
    };

    // ========== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° ==========
    function decodeShiftJIS(buffer) {
      // è¤‡æ•°ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åã‚’è©¦ã™
      const encodings = ['shift_jis', 'Shift_JIS', 'sjis', 'SJIS', 'shift-jis', 'windows-31j'];
      
      for (const encoding of encodings) {
        try {
          const decoder = new TextDecoder(encoding);
          const text = decoder.decode(buffer);
          // æ—¥æœ¬èªãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
          if (text.includes('â– ') || text.includes('ãƒ†ã‚£ãƒƒã‚«ãƒ¼') || text.includes('éŠ˜æŸ„') || text.includes('æŠ•è³‡ä¿¡è¨—')) {
            console.log('Successful decoding with:', encoding);
            return text;
          }
        } catch (e) {
          console.log('Failed to decode with:', encoding, e.message);
        }
      }
      
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: UTF-8ã¨ã—ã¦èª­ã¿è¾¼ã¿
      console.log('Falling back to UTF-8');
      return new TextDecoder('utf-8').decode(buffer);
    }

    function parseNumber(str) {
      if (!str || str === '-') return 0;
      return parseFloat(str.replace(/"/g, '').replace(/,/g, '').trim()) || 0;
    }

    // CSVã®1è¡Œã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå†…ã®ã‚«ãƒ³ãƒã«å¯¾å¿œï¼‰
    function parseCSVLine(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          result.push(current.replace(/"/g, '').trim());
          current = '';
        } else {
          current += char;
        }
      }
      result.push(current.replace(/"/g, '').trim());
      return result;
    }

    function detectCSVType(text) {
      if (text.includes('ãƒ†ã‚£ãƒƒã‚«ãƒ¼') && text.includes('USãƒ‰ãƒ«')) return 'US';
      if (text.includes('éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰') && !text.includes('ãƒ•ã‚¡ãƒ³ãƒ‰')) return 'JP';
      if (text.includes('ãƒ•ã‚¡ãƒ³ãƒ‰') || text.includes('æŠ•è³‡ä¿¡è¨—')) return 'FUND';
      if (text.includes('é€šè²¨') && text.includes('æ®‹é«˜ï¼»ç¾åœ°é€šè²¨ï¼½') && text.includes('æ®‹é«˜ï¼»å††ï¼½')) return 'FOREIGN_CASH';
      return 'UNKNOWN';
    }

    // ========== å¤–è²¨é ã‚Šé‡‘è§£æé–¢æ•° ==========
    function parseForeignCashCSV(text) {
      console.log('=== parseForeignCashCSV ===');
      const lines = text.split('\n');
      const cashItems = [];
      
      for (const line of lines) {
        // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
        if (line.includes('é€šè²¨') && line.includes('æ®‹é«˜')) continue;
        if (!line.trim()) continue;
        
        const parts = parseCSVLine(line);
        if (parts.length >= 3) {
          const currency = parts[0]; // "ç±³ãƒ‰ãƒ«(å††æ›ç®—é¡)"
          const balanceLocal = parts[1]; // "581.80USD"
          const balanceJPY = parseNumber(parts[2]); // "91,988"
          
          console.log(`Foreign Cash: ${currency}, ${balanceLocal}, Â¥${balanceJPY}`);
          
          if (currency && balanceJPY > 0) {
            // é€šè²¨åã‹ã‚‰é€šè²¨ã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡º
            let currencyCode = 'USD';
            if (currency.includes('ç±³ãƒ‰ãƒ«')) currencyCode = 'USD';
            else if (currency.includes('ãƒ¦ãƒ¼ãƒ­')) currencyCode = 'EUR';
            else if (currency.includes('è±ªãƒ‰ãƒ«')) currencyCode = 'AUD';
            
            cashItems.push({
              type: 'CASH',
              ticker: currencyCode,
              name: currency.replace(/\(.*\)/, '').trim(),
              value: balanceJPY,
              valueCurrency: 'JPY',
              gainPercent: 0,
              balanceLocal: balanceLocal
            });
          }
        }
      }
      console.log('Total foreign cash items:', cashItems.length, 'Total value:', cashItems.reduce((s,x) => s + x.value, 0));
      return cashItems;
    }

    // ========== CSVè§£æé–¢æ•° ==========
    function parseUSStockCSV(text) {
      console.log('=== parseUSStockCSV ===');
      const lines = text.split('\n');
      const stocks = [];
      let currentSection = '';

      for (const line of lines) {
        if (line.includes('â– ç‰¹å®šå£åº§') || line.includes('â– NISA')) {
          currentSection = line.includes('NISA') ? 'NISA' : 'ç‰¹å®šå£åº§';
          console.log('Section:', currentSection);
          continue;
        }
        if (line.startsWith('"') && !line.includes('ãƒ†ã‚£ãƒƒã‚«ãƒ¼')) {
          const parts = parseCSVLine(line);
          if (parts.length >= 13) {
            const ticker = parts[0];
            const name = parts[1];
            const quantity = parseNumber(parts[3]);
            const avgPrice = parseNumber(parts[8]);
            const currentPrice = parseNumber(parts[10]);
            const dailyChange = parseNumber(parts[11]);
            const value = parseNumber(parts[12]);
            const gainPercent = parseNumber(parts[13]);
            
            console.log(`US Stock: ${ticker}, qty=${quantity}, value=${value}`);

            if (ticker && quantity > 0) {
              stocks.push({
                type: 'US', ticker, name, quantity, avgPrice, currentPrice,
                dailyChange, monthlyChange: null, value, valueCurrency: 'USD',
                gainPercent, section: currentSection, earnings: US_EARNINGS[ticker] || null
              });
            }
          }
        }
      }
      console.log('Total US stocks:', stocks.length, 'Total value:', stocks.reduce((s,x) => s + x.value, 0));
      return mergeStocks(stocks);
    }

    function parseJPStockCSV(text) {
      console.log('=== parseJPStockCSV ===');
      console.log('Text preview:', text.slice(0, 500));
      const lines = text.split('\n');
      const stocks = [];
      let currentSection = '';
      let isNISASection = false;

      for (const line of lines) {
        if (line.includes('â– ç‰¹å®šå£åº§')) { 
          currentSection = 'ç‰¹å®šå£åº§'; 
          isNISASection = false;
          console.log('Section: ç‰¹å®šå£åº§');
          continue; 
        }
        if (line.includes('â– NISA')) { 
          currentSection = 'NISA'; 
          isNISASection = true;
          console.log('Section: NISA');
          continue; 
        }
        
        if (line.startsWith('"') && !line.includes('éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰')) {
          const parts = parseCSVLine(line);
          
          // åˆè¨ˆè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
          if (parts.some(p => p.includes('åˆè¨ˆ'))) continue;
          
          const code = parts[0];
          const name = parts[1];
          const quantity = parseNumber(parts[2]);
          
          console.log(`JP parsing: code=${code}, name=${name}, parts.length=${parts.length}, isNISA=${isNISASection}`);
          
          let avgPrice, currentPrice, monthlyChange, value, gainPercent;
          
          if (isNISASection && parts.length >= 16) {
            // NISAå£åº§ã¯åˆ—ãŒå¤šã„ï¼ˆ18åˆ—ï¼‰
            avgPrice = parseNumber(parts[8]);
            currentPrice = parseNumber(parts[12]);
            monthlyChange = parseNumber(parts[13]);
            value = parseNumber(parts[14]);
            gainPercent = parseNumber(parts[15]);
            console.log(`  NISA: value=${value} (parts[14]=${parts[14]})`);
          } else if (parts.length >= 10) {
            // ç‰¹å®šå£åº§ï¼ˆ12åˆ—ï¼‰
            avgPrice = parseNumber(parts[6]);
            currentPrice = parseNumber(parts[8]);
            monthlyChange = parseNumber(parts[9]);
            value = parseNumber(parts[10]);
            gainPercent = parseNumber(parts[11]);
            console.log(`  ç‰¹å®š: value=${value} (parts[10]=${parts[10]})`);
          } else {
            console.log(`  Skipped: parts.length=${parts.length}`);
            continue;
          }

          if (code && quantity > 0 && value > 0) {
            stocks.push({
              type: 'JP', ticker: code, name, quantity, avgPrice, currentPrice,
              dailyChange: null, monthlyChange, value, valueCurrency: 'JPY',
              gainPercent, section: currentSection, earnings: JP_EARNINGS[code] || null
            });
          }
        }
      }
      console.log('Total JP stocks:', stocks.length, 'Total value:', stocks.reduce((s,x) => s + x.value, 0));
      return mergeStocks(stocks);
    }

    function parseFundCSV(text) {
      console.log('=== parseFundCSV ===');
      console.log('Text preview:', text.slice(0, 500));
      const lines = text.split('\n');
      const funds = [];

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i];
        if (!line.trim()) continue;
        
        const parts = parseCSVLine(line);
        console.log(`Fund line ${i}: parts.length=${parts.length}`);
        
        if (parts.length >= 15) {
          const section = parts[1];
          const name = parts[2];
          const quantity = parseNumber(parts[4]);
          const avgPrice = parseNumber(parts[7]);
          const currentPrice = parseNumber(parts[9]);
          const dailyChange = parseNumber(parts[10]);
          const monthlyChange = parseNumber(parts[11]);
          const value = parseNumber(parts[12]);
          const gainPercent = parseNumber(parts[14]);
          
          console.log(`  name=${name.slice(0,20)}, qty=${quantity}, value=${value}`);

          if (name && quantity > 0 && value > 0) {
            funds.push({
              type: 'FUND', ticker: name.slice(0, 20), name, quantity, avgPrice, currentPrice,
              dailyChange, monthlyChange, value, valueCurrency: 'JPY',
              gainPercent, section, sections: [section], earnings: null
            });
          }
        } else {
          console.log(`  Skipped: parts.length < 15`);
        }
      }
      console.log('Total funds:', funds.length, 'Total value:', funds.reduce((s,x) => s + x.value, 0));
      return funds;
    }

    function mergeStocks(stocks) {
      const merged = {};
      for (const stock of stocks) {
        if (merged[stock.ticker]) {
          merged[stock.ticker].quantity += stock.quantity;
          merged[stock.ticker].value += stock.value;
          merged[stock.ticker].sections = [...new Set([...merged[stock.ticker].sections, stock.section])];
        } else {
          merged[stock.ticker] = { ...stock, sections: [stock.section] };
        }
      }
      return Object.values(merged);
    }

    // ========== æ—¥æœ¬æ™‚é–“å¤‰æ› ==========
    function convertToJapanTime(usDateStr, timeType) {
      const usDate = new Date(usDateStr + 'T00:00:00');
      if (timeType === 'BMO') return { date: usDate, japanTime: '21:00', calendarTime: '210000' };
      if (timeType === 'AMC') {
        const nextDay = new Date(usDate);
        nextDay.setDate(nextDay.getDate() + 1);
        return { date: nextDay, japanTime: '06:30', calendarTime: '063000' };
      }
      if (timeType === 'JP') return { date: usDate, japanTime: '15:00', calendarTime: '150000' };
      return { date: usDate, japanTime: null, calendarTime: null };
    }

    // ========== ICSç”Ÿæˆ ==========
    function generateICS(allStocks, reminderDays = 3) {
      const stocksWithEarnings = allStocks.filter(s => s.earnings?.nextEarnings);
      
      const events = stocksWithEarnings.map(stock => {
        const timeType = stock.earnings.time;
        const japanInfo = convertToJapanTime(stock.earnings.nextEarnings, timeType);
        const dateStr = japanInfo.date.toISOString().split('T')[0].replace(/-/g, '');
        
        let dtStart, dtEnd;
        if (japanInfo.calendarTime) {
          dtStart = `DTSTART;TZID=Asia/Tokyo:${dateStr}T${japanInfo.calendarTime}`;
          const endHour = timeType === 'AMC' ? '073000' : timeType === 'BMO' ? '220000' : '160000';
          dtEnd = `DTEND;TZID=Asia/Tokyo:${dateStr}T${endHour}`;
        } else {
          const nextDay = new Date(japanInfo.date);
          nextDay.setDate(nextDay.getDate() + 1);
          dtStart = `DTSTART;VALUE=DATE:${dateStr}`;
          dtEnd = `DTEND;VALUE=DATE:${nextDay.toISOString().split('T')[0].replace(/-/g, '')}`;
        }

        const marketLabel = stock.type === 'US' ? 'ğŸ‡ºğŸ‡¸' : 'ğŸ‡¯ğŸ‡µ';
        const timeNote = timeType === 'BMO' ? 'ï¼ˆæ—¥æœ¬æ™‚é–“21æ™‚é ƒï¼‰' : 
                        timeType === 'AMC' ? 'ï¼ˆæ—¥æœ¬æ™‚é–“ç¿Œæœ6æ™‚åŠé ƒï¼‰' : 
                        timeType === 'JP' ? 'ï¼ˆ15æ™‚é ƒï¼‰' : '';

        return `BEGIN:VEVENT
${dtStart}
${dtEnd}
SUMMARY:ğŸ“Š ${marketLabel} ${stock.ticker} ${stock.name} æ±ºç®—${timeNote}
DESCRIPTION:ä¿æœ‰æ•°é‡: ${stock.quantity}${stock.type === 'FUND' ? 'å£' : 'æ ª'}\\nè©•ä¾¡é¡: ${stock.valueCurrency === 'USD' ? '$' : 'Â¥'}${stock.value.toLocaleString()}\\næç›Šç‡: ${stock.gainPercent > 0 ? '+' : ''}${stock.gainPercent}%
LOCATION:${stock.ticker}
BEGIN:VALARM
TRIGGER:-P${reminderDays}D
ACTION:DISPLAY
DESCRIPTION:${stock.ticker}ã®æ±ºç®—ç™ºè¡¨ãŒ${reminderDays}æ—¥å¾Œã§ã™
END:VALARM
END:VEVENT`;
      });

      return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//æ¥½å¤©è¨¼åˆ¸å¯¾å¿œè³‡ç”£ç®¡ç†ãƒ„ãƒ¼ãƒ«//JP
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:ä¿æœ‰æ ªå¼æ±ºç®—ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
X-WR-TIMEZONE:Asia/Tokyo
BEGIN:VTIMEZONE
TZID:Asia/Tokyo
BEGIN:STANDARD
TZOFFSETFROM:+0900
TZOFFSETTO:+0900
TZNAME:JST
DTSTART:19700101T000000
END:STANDARD
END:VTIMEZONE
${events.join('\n')}
END:VCALENDAR`;
    }

    // ========== ã‚·ãƒ³ãƒ—ãƒ«ãªå††ã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ==========
    function SimplePieChart({ data }) {
      const total = data.reduce((sum, d) => sum + d.value, 0);
      if (total === 0) return null;
      
      let currentAngle = 0;
      const paths = data.map((d, i) => {
        const percentage = d.value / total;
        const angle = percentage * 360;
        const startAngle = currentAngle;
        const endAngle = currentAngle + angle;
        currentAngle = endAngle;
        
        const startRad = (startAngle - 90) * Math.PI / 180;
        const endRad = (endAngle - 90) * Math.PI / 180;
        const largeArc = angle > 180 ? 1 : 0;
        
        const x1 = 100 + 80 * Math.cos(startRad);
        const y1 = 100 + 80 * Math.sin(startRad);
        const x2 = 100 + 80 * Math.cos(endRad);
        const y2 = 100 + 80 * Math.sin(endRad);
        
        const pathD = `M 100 100 L ${x1} ${y1} A 80 80 0 ${largeArc} 1 ${x2} ${y2} Z`;
        
        return (
          <path key={i} d={pathD} fill={d.color} stroke="white" strokeWidth="2">
            <title>{d.name}: Â¥{Math.round(d.value).toLocaleString()} ({(percentage * 100).toFixed(1)}%)</title>
          </path>
        );
      });

      return (
        <div className="flex items-center gap-4">
          <svg width="200" height="200" viewBox="0 0 200 200">
            {paths}
            <circle cx="100" cy="100" r="50" fill="white" />
          </svg>
          <div className="space-y-2">
            {data.map((d, i) => (
              <div key={i} className="flex items-center gap-2 text-sm">
                <div className="w-3 h-3 rounded-full" style={{ backgroundColor: d.color }}></div>
                <span className="text-slate-600">{d.name}</span>
                <span className="font-medium">{(d.value / total * 100).toFixed(0)}%</span>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // ========== ã‚·ãƒ³ãƒ—ãƒ«ãªæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ==========
    function SimpleLineChart({ data }) {
      if (data.length === 0) {
        return (
          <div className="h-64 flex items-center justify-center text-slate-500">
            <div className="text-center">
              <p className="mb-2">å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
              <p className="text-sm">ã€ŒğŸ’¾ ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã€ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ãã ã•ã„</p>
            </div>
          </div>
        );
      }
      
      // 1ä»¶ã®å ´åˆã¯å˜ä¸€ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º
      if (data.length === 1) {
        const d = data[0];
        return (
          <div className="h-64 flex items-center justify-center">
            <div className="text-center">
              <p className="text-4xl font-bold text-blue-600">Â¥{Math.round(d.value * 10000).toLocaleString()}</p>
              <p className="text-slate-500 mt-2">{d.date}</p>
              <p className="text-sm text-slate-400 mt-1">ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆã‚‹ã¨ã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
          </div>
        );
      }

      const values = data.map(d => d.value);
      const maxVal = Math.max(...values);
      const minVal = Math.min(...values);
      const range = maxVal - minVal || 1;
      const padding = range * 0.1;

      const width = 500;
      const height = 200;
      const marginLeft = 50;
      const marginBottom = 30;

      const points = data.map((d, i) => {
        const x = marginLeft + (i / (data.length - 1)) * (width - marginLeft - 20);
        const y = height - marginBottom - ((d.value - minVal + padding) / (range + padding * 2)) * (height - marginBottom - 20);
        return { x, y, ...d };
      });

      const pathD = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ');

      return (
        <svg width="100%" height="250" viewBox={`0 0 ${width} ${height + 20}`} className="overflow-visible">
          {/* ã‚°ãƒªãƒƒãƒ‰ç·š */}
          {[0, 1, 2, 3, 4].map(i => {
            const y = 20 + (i / 4) * (height - marginBottom - 20);
            const val = maxVal + padding - (i / 4) * (range + padding * 2);
            return (
              <g key={i}>
                <line x1={marginLeft} y1={y} x2={width - 20} y2={y} stroke="#E2E8F0" strokeDasharray="3 3" />
                <text x={marginLeft - 5} y={y + 4} textAnchor="end" fill="#94A3B8" fontSize="10">{Math.round(val)}ä¸‡</text>
              </g>
            );
          })}
          
          {/* æŠ˜ã‚Œç·š */}
          <path d={pathD} fill="none" stroke="#3B82F6" strokeWidth="2" />
          
          {/* ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ */}
          {points.map((p, i) => (
            <g key={i}>
              <circle cx={p.x} cy={p.y} r="4" fill="#3B82F6" />
              {i % Math.ceil(data.length / 6) === 0 && (
                <text x={p.x} y={height - 10} textAnchor="middle" fill="#94A3B8" fontSize="10">{p.date}</text>
              )}
            </g>
          ))}
        </svg>
      );
    }

    // ========== ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ==========
    function App() {
      const [usStocks, setUSStocks] = useState([]);
      const [jpStocks, setJPStocks] = useState([]);
      const [funds, setFunds] = useState([]);
      const [foreignCash, setForeignCash] = useState([]);
      const [exchangeRate, setExchangeRate] = useState(158);
      const [isDragging, setIsDragging] = useState(false);
      const [activeTab, setActiveTab] = useState('overview');
      const [reminderDays, setReminderDays] = useState(3);
      const [history, setHistory] = useState([]);
      const [loadedFiles, setLoadedFiles] = useState([]);
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
      const [currentUser, setCurrentUser] = useState('default');
      const [users, setUsers] = useState(['default']);
      const [showUserModal, setShowUserModal] = useState(false);
      const [newUserName, setNewUserName] = useState('');
      
      // å±¥æ­´ã‹ã‚‰ã®è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ï¼ˆCSVãªã—ã§ã‚‚è¡¨ç¤ºå¯èƒ½ã«ï¼‰
      const [viewMode, setViewMode] = useState('csv'); // 'csv' | 'history'
      const [selectedHistoryDate, setSelectedHistoryDate] = useState(null);
      
      // æŠ•è³‡å®¶ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
      const [profile, setProfile] = useState({
        age: '',
        purpose: 'è€å¾Œè³‡é‡‘',
        riskTolerance: 'ä¸­',
        concerns: '',
      });
      const [adviceType, setAdviceType] = useState('balanced');
      const [lastSaved, setLastSaved] = useState(null);

      // èµ·å‹•æ™‚ã®è‡ªå‹•ãƒ­ãƒ¼ãƒ‰
      useEffect(() => {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿
        const savedUsers = localStorage.getItem('portfolio_users');
        if (savedUsers) {
          setUsers(JSON.parse(savedUsers));
        }
        const savedCurrentUser = localStorage.getItem('portfolio_current_user') || 'default';
        setCurrentUser(savedCurrentUser);
        
        // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ï¼‰
        const savedProfile = localStorage.getItem(`investor_profile_${savedCurrentUser}`);
        if (savedProfile) setProfile(JSON.parse(savedProfile));
        
        // æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ãƒ­ãƒ¼ãƒ‰
        loadUserData(savedCurrentUser);
      }, []);
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’localStorageã‹ã‚‰èª­ã¿è¾¼ã‚€
      const loadUserData = (userName) => {
        const savedData = localStorage.getItem(`portfolio_data_${userName}`);
        if (savedData) {
          try {
            const data = JSON.parse(savedData);
            if (data.usStocks) setUSStocks(data.usStocks);
            if (data.jpStocks) setJPStocks(data.jpStocks);
            if (data.funds) setFunds(data.funds);
            if (data.foreignCash) setForeignCash(data.foreignCash);
            if (data.exchangeRate) setExchangeRate(data.exchangeRate);
            if (data.history) setHistory(data.history);
            if (data.lastSaved) setLastSaved(data.lastSaved);
            setLoadedFiles(['è‡ªå‹•å¾©å…ƒ']);
            setViewMode('history');
            setSelectedHistoryDate(data.lastSaved?.split('T')[0] || null);
          } catch (e) {
            console.error('Failed to load saved data:', e);
          }
        }
      };
      
      // ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ä¿å­˜ï¼ˆCSVèª­ã¿è¾¼ã¿å¾Œã«å‘¼ã°ã‚Œã‚‹ï¼‰
      const autoSaveData = (newUSStocks, newJPStocks, newFunds, newForeignCash, newExchangeRate) => {
        const totalUS = newUSStocks.reduce((sum, s) => sum + s.value, 0);
        const totalJP = newJPStocks.reduce((sum, s) => sum + s.value, 0);
        const totalFundsVal = newFunds.reduce((sum, f) => sum + f.value, 0);
        const totalCash = newForeignCash.reduce((sum, c) => sum + c.value, 0);
        const totalValueJPY = (totalUS * newExchangeRate) + totalJP + totalFundsVal + totalCash;
        
        const now = new Date().toISOString();
        const today = now.split('T')[0];
        
        // å±¥æ­´ã«è¿½åŠ 
        const historyEntry = { date: today, totalValueJPY, exchangeRate: newExchangeRate };
        const currentHistory = JSON.parse(localStorage.getItem(`portfolio_data_${currentUser}`) || '{}').history || [];
        const newHistory = [...currentHistory.filter(h => h.date !== today), historyEntry]
          .sort((a, b) => a.date.localeCompare(b.date))
          .slice(-365);
        
        // localStorageã«ä¿å­˜
        const saveData = {
          version: '5.1.0',
          user: currentUser,
          lastSaved: now,
          exchangeRate: newExchangeRate,
          usStocks: newUSStocks,
          jpStocks: newJPStocks,
          funds: newFunds,
          foreignCash: newForeignCash,
          history: newHistory
        };
        localStorage.setItem(`portfolio_data_${currentUser}`, JSON.stringify(saveData));
        
        setHistory(newHistory);
        setLastSaved(now);
      };
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼å¤‰æ›´æ™‚ã®å‡¦ç†
      const switchUser = (userName) => {
        setCurrentUser(userName);
        localStorage.setItem('portfolio_current_user', userName);
        // ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
        const savedProfile = localStorage.getItem(`investor_profile_${userName}`);
        if (savedProfile) {
          setProfile(JSON.parse(savedProfile));
        } else {
          setProfile({ age: '', purpose: 'è€å¾Œè³‡é‡‘', riskTolerance: 'ä¸­', concerns: '' });
        }
        // ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        setUSStocks([]);
        setJPStocks([]);
        setFunds([]);
        setForeignCash([]);
        setHistory([]);
        setLoadedFiles([]);
        setLastSaved(null);
        loadUserData(userName);
      };
      
      // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
      const addUser = () => {
        if (!newUserName.trim()) return;
        if (users.includes(newUserName.trim())) {
          alert('åŒã˜åå‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ã¾ã™');
          return;
        }
        const newUsers = [...users, newUserName.trim()];
        setUsers(newUsers);
        localStorage.setItem('portfolio_users', JSON.stringify(newUsers));
        setNewUserName('');
        setShowUserModal(false);
        switchUser(newUserName.trim());
      };
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
      const deleteUser = (userName) => {
        if (userName === 'default') {
          alert('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‰Šé™¤ã§ãã¾ã›ã‚“');
          return;
        }
        if (!confirm(`ã€Œ${userName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
        const newUsers = users.filter(u => u !== userName);
        setUsers(newUsers);
        localStorage.setItem('portfolio_users', JSON.stringify(newUsers));
        if (currentUser === userName) {
          switchUser('default');
        }
      };
      
      const saveProfile = () => {
        localStorage.setItem(`investor_profile_${currentUser}`, JSON.stringify(profile));
        alert('ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
      };
      
      // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      const downloadBackup = () => {
        const totalUS = usStocks.reduce((sum, s) => sum + s.value, 0);
        const totalJP = jpStocks.reduce((sum, s) => sum + s.value, 0);
        const totalFundsVal = funds.reduce((sum, f) => sum + f.value, 0);
        const totalCash = foreignCash.reduce((sum, c) => sum + c.value, 0);
        const totalValueJPY = (totalUS * exchangeRate) + totalJP + totalFundsVal + totalCash;
        
        if (totalValueJPY === 0) {
          alert('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
          return;
        }
        
        const today = new Date().toISOString().split('T')[0];
        const data = {
          version: '5.1.0',
          type: 'backup',
          user: currentUser,
          exportedAt: new Date().toISOString(),
          exchangeRate: exchangeRate,
          usStocks: usStocks,
          jpStocks: jpStocks,
          funds: funds,
          foreignCash: foreignCash,
          history: history,
          profile: profile
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `portfolio-backup-${currentUser}-${today}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        alert(`ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\nä»»æ„ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã—ã¦ç®¡ç†ã—ã¦ãã ã•ã„ã€‚`);
      };
      
      // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆPCç§»è¡Œãªã©ï¼‰
      const importBackup = (files) => {
        const fileArray = Array.from(files);
        let loadedCount = 0;
        let newHistory = [...history];
        let latestData = null;
        
        fileArray.forEach(file => {
          const reader = new FileReader();
          reader.onload = (event) => {
            try {
              const data = JSON.parse(event.target.result);
              
              // v5.1å½¢å¼ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆå¤–è²¨é ã‚Šé‡‘å¯¾å¿œï¼‰
              if ((data.version === '5.1.0' || data.version === '5.0.0') && data.usStocks) {
                if (!latestData || (data.exportedAt && data.exportedAt > latestData.exportedAt)) {
                  latestData = data;
                }
                if (data.history) {
                  data.history.forEach(h => {
                    newHistory = [...newHistory.filter(e => e.date !== h.date), h];
                  });
                }
              }
              // v4å½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«
              else if (data.version && data.date && data.breakdown) {
                const totalValueJPY = data.totalValueJPY || 0;
                const entry = {
                  date: data.date,
                  totalValueJPY: totalValueJPY,
                  exchangeRate: data.exchangeRate || 158
                };
                newHistory = [...newHistory.filter(h => h.date !== entry.date), entry];
                
                if (!latestData || data.date > (latestData.date || '')) {
                  latestData = {
                    usStocks: data.breakdown?.usStocks?.items || [],
                    jpStocks: data.breakdown?.jpStocks?.items || [],
                    funds: data.breakdown?.funds?.items || [],
                    foreignCash: [],
                    exchangeRate: data.exchangeRate || 158,
                    exportedAt: data.savedAt
                  };
                }
              }
              // æ—§å½¢å¼ï¼ˆhistoryãŒé…åˆ—ï¼‰
              else if (data.history && Array.isArray(data.history)) {
                data.history.forEach(h => {
                  newHistory = [...newHistory.filter(e => e.date !== h.date), h];
                });
              }
              
              loadedCount++;
              
              // å…¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†
              if (loadedCount === fileArray.length) {
                newHistory.sort((a, b) => a.date.localeCompare(b.date));
                setHistory(newHistory);
                
                // æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°è¡¨ç¤ºç”¨ã«ã‚»ãƒƒãƒˆ
                if (latestData) {
                  if (latestData.usStocks) setUSStocks(latestData.usStocks);
                  if (latestData.jpStocks) setJPStocks(latestData.jpStocks);
                  if (latestData.funds) setFunds(latestData.funds);
                  if (latestData.foreignCash) setForeignCash(latestData.foreignCash);
                  if (latestData.exchangeRate) setExchangeRate(latestData.exchangeRate);
                  if (latestData.profile) setProfile(latestData.profile);
                  setViewMode('history');
                  setLoadedFiles(['ã‚¤ãƒ³ãƒãƒ¼ãƒˆ']);
                }
                
                // localStorageã«ã‚‚ä¿å­˜
                const saveData = {
                  version: '5.1.0',
                  user: currentUser,
                  lastSaved: new Date().toISOString(),
                  exchangeRate: latestData?.exchangeRate || exchangeRate,
                  usStocks: latestData?.usStocks || usStocks,
                  jpStocks: latestData?.jpStocks || jpStocks,
                  funds: latestData?.funds || funds,
                  foreignCash: latestData?.foreignCash || foreignCash,
                  history: newHistory
                };
                localStorage.setItem(`portfolio_data_${currentUser}`, JSON.stringify(saveData));
                
                alert(`${loadedCount}ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
              }
            } catch (err) {
              console.error('Failed to parse file:', file.name, err);
              alert(`ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${file.name}`);
            }
          };
          reader.readAsText(file);
        });
      };

      // AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
      const generateAIPrompt = () => {
        const today = new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });
        
        const adviceTypeText = {
          short: 'ã€çŸ­æœŸï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰ã€‘',
          medium: 'ã€ä¸­æœŸï¼ˆ3ã€œ6ãƒ¶æœˆï¼‰ã€‘',
          long: 'ã€é•·æœŸï¼ˆ1å¹´ä»¥ä¸Šï¼‰ã€‘',
          balanced: 'ã€ç·åˆï¼ˆçŸ­æœŸãƒ»ä¸­æœŸãƒ»é•·æœŸã™ã¹ã¦ï¼‰ã€‘'
        }[adviceType];

        const adviceRequest = {
          short: `
## ğŸ“… çŸ­æœŸï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰ã®åˆ†æã‚’ãŠé¡˜ã„ã—ã¾ã™

ä»¥ä¸‹ã®è¦³ç‚¹ã§ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ãã ã•ã„ï¼š
1. ç›´è¿‘ã®æ±ºç®—ç™ºè¡¨äºˆå®šã¨äºˆæƒ³ã•ã‚Œã‚‹å½±éŸ¿
2. ä»Šé€±ã€œæ¥æœˆã®é‡è¦çµŒæ¸ˆã‚¤ãƒ™ãƒ³ãƒˆï¼ˆFOMCã€é›‡ç”¨çµ±è¨ˆãªã©ï¼‰
3. ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«çš„ãªå£²è²·ã‚¿ã‚¤ãƒŸãƒ³ã‚°
4. çŸ­æœŸçš„ãªãƒªã‚¹ã‚¯è¦å› ã¨å¯¾å‡¦æ³•
5. ä¿æœ‰éŠ˜æŸ„ã«é–¢ã™ã‚‹ç›´è¿‘ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ææ–™`,
          medium: `
## ğŸ“† ä¸­æœŸï¼ˆ3ã€œ6ãƒ¶æœˆï¼‰ã®åˆ†æã‚’ãŠé¡˜ã„ã—ã¾ã™

ä»¥ä¸‹ã®è¦³ç‚¹ã§ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ãã ã•ã„ï¼š
1. ã‚»ã‚¯ã‚¿ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®è¦‹é€šã—
2. å­£ç¯€æ€§ãƒ»ã‚¢ãƒãƒãƒªãƒ¼ï¼ˆSell in Mayã€å¹´æœ«ãƒ©ãƒªãƒ¼ãªã©ï¼‰
3. é‡‘åˆ©å‹•å‘ã¨æ ªå¼å¸‚å ´ã¸ã®å½±éŸ¿
4. ãƒªãƒãƒ©ãƒ³ã‚¹ã®å¿…è¦æ€§ã¨å…·ä½“çš„ãªææ¡ˆ
5. ä¸­æœŸçš„ã«æ³¨ç›®ã™ã¹ãéŠ˜æŸ„ãƒ»ãƒ†ãƒ¼ãƒ`,
          long: `
## ğŸ“ˆ é•·æœŸï¼ˆ1å¹´ä»¥ä¸Šï¼‰ã®åˆ†æã‚’ãŠé¡˜ã„ã—ã¾ã™

ä»¥ä¸‹ã®è¦³ç‚¹ã§ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ãã ã•ã„ï¼š
1. è³‡ç”£é…åˆ†ï¼ˆã‚¢ã‚»ãƒƒãƒˆã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã®è©•ä¾¡
2. é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰ã¨ã®æ•´åˆæ€§ï¼ˆAIã€é«˜é½¢åŒ–ã€è„±ç‚­ç´ ãªã©ï¼‰
3. åœ°åŸŸåˆ†æ•£ã®é©åˆ‡æ€§ï¼ˆç±³å›½åé‡ãƒªã‚¹ã‚¯ãªã©ï¼‰
4. ç©ç«‹æˆ¦ç•¥ã®æœ€é©åŒ–
5. 10å¹´å¾Œã‚’è¦‹æ®ãˆãŸãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ”¹å–„æ¡ˆ`,
          balanced: `
## âš–ï¸ ç·åˆåˆ†æã‚’ãŠé¡˜ã„ã—ã¾ã™

### ğŸ“… çŸ­æœŸï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰
- ç›´è¿‘ã®æ±ºç®—ãƒ»çµŒæ¸ˆã‚¤ãƒ™ãƒ³ãƒˆã®å½±éŸ¿
- ä¿æœ‰éŠ˜æŸ„ã®æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»ææ–™

### ğŸ“† ä¸­æœŸï¼ˆ3ã€œ6ãƒ¶æœˆï¼‰
- å­£ç¯€æ€§ã‚¢ãƒãƒãƒªãƒ¼ã®è€ƒæ…®
- ãƒªãƒãƒ©ãƒ³ã‚¹ã®ææ¡ˆ

### ğŸ“ˆ é•·æœŸï¼ˆ1å¹´ä»¥ä¸Šï¼‰
- ã‚¢ã‚»ãƒƒãƒˆã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è©•ä¾¡
- é•·æœŸçš„ãªæ”¹å–„ææ¡ˆ`
        }[adviceType];

        // ä¿æœ‰éŠ˜æŸ„ãƒªã‚¹ãƒˆç”Ÿæˆ
        let holdingsText = '';
        
        if (funds.length > 0) {
          holdingsText += '\nã€æŠ•è³‡ä¿¡è¨—ã€‘\n';
          funds.forEach(f => {
            holdingsText += `- ${f.name}: Â¥${f.value.toLocaleString()} (${f.gainPercent >= 0 ? '+' : ''}${f.gainPercent}%)\n`;
          });
        }
        
        if (jpStocks.length > 0) {
          holdingsText += '\nã€æ—¥æœ¬æ ªãƒ»ETFã€‘\n';
          jpStocks.forEach(s => {
            holdingsText += `- ${s.name}(${s.ticker}): Â¥${s.value.toLocaleString()} (${s.gainPercent >= 0 ? '+' : ''}${s.gainPercent}%)\n`;
          });
        }
        
        if (usStocks.length > 0) {
          holdingsText += '\nã€ç±³å›½æ ªã€‘\n';
          usStocks.forEach(s => {
            holdingsText += `- ${s.name}(${s.ticker}): $${s.value.toLocaleString()} (${s.gainPercent >= 0 ? '+' : ''}${s.gainPercent}%)\n`;
          });
        }

        // æ±ºç®—äºˆå®š
        let earningsText = '';
        if (stocksWithEarnings.length > 0) {
          earningsText = '\nã€ç›´è¿‘ã®æ±ºç®—äºˆå®šã€‘\n';
          stocksWithEarnings.slice(0, 5).forEach(s => {
            const jpInfo = convertToJapanTime(s.earnings.nextEarnings, s.earnings.time);
            earningsText += `- ${s.ticker}: ${jpInfo.date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })} ${jpInfo.japanTime || ''}\n`;
          });
        }

        return `ã‚ãªãŸã¯çµŒé¨“è±Šå¯ŒãªæŠ•è³‡ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã§ã™ã€‚
ä»¥ä¸‹ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã«ã¤ã„ã¦ã€æœ€æ–°ã®å¸‚å ´å‹•å‘ã‚’è¸ã¾ãˆã¦åˆ†æãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªåˆ†æãƒªã‚¯ã‚¨ã‚¹ãƒˆ ${adviceTypeText}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åˆ†ææ—¥: ${today}

## ğŸ‘¤ æŠ•è³‡å®¶ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
- å¹´é½¢: ${profile.age || 'æœªè¨­å®š'}
- æŠ•è³‡ç›®çš„: ${profile.purpose}
- ãƒªã‚¹ã‚¯è¨±å®¹åº¦: ${profile.riskTolerance}
- è³ªå•ãƒ»ç›¸è«‡: ${profile.concerns || 'ç‰¹ã«ãªã—'}

## ğŸ’° ç¾åœ¨ã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª

ç·è³‡ç”£: Â¥${Math.round(totalValueJPY).toLocaleString()}

è³‡ç”£é…åˆ†:
- ç±³å›½æ ª: Â¥${Math.round(totalUSValueJPY).toLocaleString()} (${totalValueJPY > 0 ? Math.round(totalUSValueJPY / totalValueJPY * 100) : 0}%)
- æ—¥æœ¬æ ª: Â¥${Math.round(totalJPValue).toLocaleString()} (${totalValueJPY > 0 ? Math.round(totalJPValue / totalValueJPY * 100) : 0}%)
- æŠ•è³‡ä¿¡è¨—: Â¥${Math.round(totalFundValue).toLocaleString()} (${totalValueJPY > 0 ? Math.round(totalFundValue / totalValueJPY * 100) : 0}%)

ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ: ${exchangeRate} å††/USD
${holdingsText}${earningsText}
${adviceRequest}

## ğŸ“° è¿½åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- ä¿æœ‰éŠ˜æŸ„ã«é–¢ã™ã‚‹**æœ€æ–°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚„ææ–™**ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„
- ç¾åœ¨ã®å¸‚å ´ã§æ³¨æ„ã™ã¹ã**ã‚¢ãƒãƒãƒªãƒ¼ã‚„å­£ç¯€æ€§**ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„
- Webæ¤œç´¢ã‚’ä½¿ã£ã¦**æœ€æ–°æƒ…å ±**ã‚’ç¢ºèªã—ã¦ãã ã•ã„

å›ç­”ã¯æ—¥æœ¬èªã§ãŠé¡˜ã„ã—ã¾ã™ã€‚`;
      };

      const allStocks = [...usStocks, ...jpStocks, ...funds];
      const hasData = allStocks.length > 0 || foreignCash.length > 0;

      const totalUSValueJPY = usStocks.reduce((sum, s) => sum + s.value * exchangeRate, 0);
      const totalJPValue = jpStocks.reduce((sum, s) => sum + s.value, 0);
      const totalFundValue = funds.reduce((sum, s) => sum + s.value, 0);
      const totalCashValue = foreignCash.reduce((sum, c) => sum + c.value, 0);
      const totalValueJPY = totalUSValueJPY + totalJPValue + totalFundValue + totalCashValue;

      // CSVèª­ã¿è¾¼ã¿å¾Œã®è‡ªå‹•ä¿å­˜
      useEffect(() => {
        // CSVã‹ã‚‰èª­ã¿è¾¼ã‚“ã å ´åˆã®ã¿è‡ªå‹•ä¿å­˜ï¼ˆè‡ªå‹•å¾©å…ƒã‚„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯é™¤ãï¼‰
        const isCSVLoaded = loadedFiles.some(f => ['ç±³å›½æ ª', 'æ—¥æœ¬æ ª', 'æŠ•è³‡ä¿¡è¨—', 'å¤–è²¨'].includes(f));
        if (isCSVLoaded && hasData) {
          autoSaveData(usStocks, jpStocks, funds, foreignCash, exchangeRate);
          setViewMode('csv');
        }
      }, [loadedFiles]);

      const handleFile = useCallback((file) => {
        console.log('=== handleFile ===');
        console.log('File name:', file.name);
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const buffer = event.target.result;
            const text = decodeShiftJIS(new Uint8Array(buffer));
            console.log('Decoded text length:', text.length);
            console.log('First 300 chars:', text.slice(0, 300));
            const csvType = detectCSVType(text);
            console.log('CSV Type detected:', csvType);

            if (csvType === 'US') {
              const parsed = parseUSStockCSV(text);
              console.log('US Stocks parsed:', parsed.length, 'items');
              setUSStocks(parsed);
              const rateMatch = text.match(/å‚è€ƒç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ.*?"([\d.]+)"/);
              if (rateMatch) {
                console.log('Exchange rate found:', rateMatch[1]);
                setExchangeRate(parseFloat(rateMatch[1]));
              }
              setLoadedFiles(prev => [...prev.filter(f => f !== 'ç±³å›½æ ª'), 'ç±³å›½æ ª']);
            } else if (csvType === 'JP') {
              const parsed = parseJPStockCSV(text);
              console.log('JP Stocks parsed:', parsed.length, 'items');
              setJPStocks(parsed);
              setLoadedFiles(prev => [...prev.filter(f => f !== 'æ—¥æœ¬æ ª'), 'æ—¥æœ¬æ ª']);
            } else if (csvType === 'FUND') {
              const parsed = parseFundCSV(text);
              console.log('Funds parsed:', parsed.length, 'items');
              setFunds(parsed);
              setLoadedFiles(prev => [...prev.filter(f => f !== 'æŠ•è³‡ä¿¡è¨—'), 'æŠ•è³‡ä¿¡è¨—']);
            } else if (csvType === 'FOREIGN_CASH') {
              const parsed = parseForeignCashCSV(text);
              console.log('Foreign Cash parsed:', parsed.length, 'items');
              setForeignCash(parsed);
              setLoadedFiles(prev => [...prev.filter(f => f !== 'å¤–è²¨'), 'å¤–è²¨']);
            } else {
              alert('å¯¾å¿œã—ã¦ã„ãªã„CSVå½¢å¼ã§ã™');
            }
          } catch (error) {
            alert('CSVã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            console.error(error);
          }
        };
        reader.readAsArrayBuffer(file);
      }, []);

      const handleDrop = useCallback((e) => {
        e.preventDefault();
        setIsDragging(false);
        const files = e.dataTransfer?.files || e.target?.files;
        if (files) Array.from(files).forEach(handleFile);
      }, [handleFile]);

      const downloadICS = () => {
        const ics = generateICS(allStocks, reminderDays);
        const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `earnings_calendar_${new Date().toISOString().split('T')[0]}.ics`;
        a.click();
        URL.revokeObjectURL(url);
      };

      const stocksWithEarnings = allStocks.filter(s => s.earnings?.nextEarnings).sort((a, b) => 
        a.earnings.nextEarnings.localeCompare(b.earnings.nextEarnings)
      );

      const pieData = [
        { name: 'ç±³å›½æ ª', value: totalUSValueJPY, color: '#3B82F6' },
        { name: 'æ—¥æœ¬æ ª', value: totalJPValue, color: '#EF4444' },
        { name: 'æŠ•è³‡ä¿¡è¨—', value: totalFundValue, color: '#10B981' },
        { name: 'å¤–è²¨é ã‚Šé‡‘', value: totalCashValue, color: '#F59E0B' },
      ].filter(d => d.value > 0);

      const chartData = history.slice(-30).map(h => ({
        date: h.date.slice(5),
        value: Math.round(h.totalValueJPY / 10000)
      }));

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
          {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« */}
          {showUserModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
              <div className="bg-white rounded-xl p-6 w-80 shadow-xl">
                <h3 className="font-bold text-slate-800 mb-4">ğŸ‘¤ æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ </h3>
                <input
                  type="text"
                  value={newUserName}
                  onChange={(e) => setNewUserName(e.target.value)}
                  placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆä¾‹: é…å¶è€…ï¼‰"
                  className="w-full border border-slate-300 rounded-lg px-3 py-2 mb-4"
                />
                <div className="flex gap-2">
                  <button
                    onClick={() => setShowUserModal(false)}
                    className="flex-1 px-4 py-2 border border-slate-300 rounded-lg text-slate-600 hover:bg-slate-50"
                  >
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                  <button
                    onClick={addUser}
                    className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                  >
                    è¿½åŠ 
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
          <header className="bg-white border-b border-slate-200 sticky top-0 z-40">
            <div className="max-w-6xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center">
                    <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                  </div>
                  <div>
                    <h1 className="text-lg font-bold text-slate-800">æ¥½å¤©è¨¼åˆ¸ è³‡ç”£ç®¡ç†ï¼†æ±ºç®—ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
                    <p className="text-xs text-slate-500">ç±³å›½æ ªãƒ»æ—¥æœ¬æ ªãƒ»æŠ•è³‡ä¿¡è¨—ã‚’çµ±åˆç®¡ç†</p>
                  </div>
                </div>
                
                {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡ã‚Šæ›¿ãˆ */}
                <div className="flex items-center gap-3">
                  <div className="flex items-center gap-2">
                    <span className="text-sm text-slate-500">ğŸ‘¤</span>
                    <select
                      value={currentUser}
                      onChange={(e) => {
                        if (e.target.value === '__add__') {
                          setShowUserModal(true);
                        } else {
                          switchUser(e.target.value);
                        }
                      }}
                      className="border border-slate-200 rounded-lg px-3 py-1.5 text-sm bg-white"
                    >
                      {users.map(u => (
                        <option key={u} value={u}>{u === 'default' ? 'è‡ªåˆ†' : u}</option>
                      ))}
                      <option value="__add__">+ æ–°è¦è¿½åŠ ...</option>
                    </select>
                    {currentUser !== 'default' && (
                      <button
                        onClick={() => deleteUser(currentUser)}
                        className="text-red-500 hover:text-red-700 text-sm"
                        title="ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤"
                      >
                        ğŸ—‘ï¸
                      </button>
                    )}
                  </div>
                  {hasData && (
                    <div className="text-sm text-slate-500 hidden sm:block">
                      {loadedFiles.join(' / ')} èª­è¾¼æ¸ˆ
                    </div>
                  )}
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-6xl mx-auto px-4 py-6">
            {/* CSVèª­ã¿è¾¼ã¿ã‚¨ãƒªã‚¢ */}
            <div className="mb-6">
              <div
                className={`border-2 border-dashed rounded-xl p-6 text-center transition-all cursor-pointer ${isDragging ? 'drag-active' : 'border-slate-300 hover:border-slate-400 bg-white'}`}
                onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}
                onDragLeave={() => setIsDragging(false)}
                onDrop={handleDrop}
                onClick={() => document.getElementById('csv-input').click()}
              >
                <div className="flex items-center justify-center gap-4">
                  <div className="text-4xl">ğŸ“</div>
                  <div className="text-left">
                    <p className="font-medium text-slate-700">CSVã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆè¤‡æ•°å¯ï¼‰</p>
                    <p className="text-xs text-slate-500">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ - ç±³å›½æ ªãƒ»æ—¥æœ¬æ ªãƒ»æŠ•è³‡ä¿¡è¨—ã®CSVã‚’è‡ªå‹•åˆ¤åˆ¥</p>
                  </div>
                </div>
                <input type="file" accept=".csv" multiple onChange={handleDrop} className="hidden" id="csv-input" />
                {loadedFiles.length > 0 && (
                  <div className="mt-3 flex items-center justify-center gap-2">
                    {loadedFiles.map(f => (
                      <span key={f} className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">âœ“ {f}</span>
                    ))}
                  </div>
                )}
              </div>
              
              {/* ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾©å…ƒã‚¨ãƒªã‚¢ */}
              {!hasData && (
                <div className="mt-4 text-center">
                  <p className="text-slate-500 text-sm mb-2">ã¾ãŸã¯</p>
                  <label className="inline-flex items-center gap-2 px-4 py-2 bg-white border border-slate-300 rounded-lg text-sm text-slate-600 hover:bg-slate-50 hover:border-slate-400 cursor-pointer transition-all">
                    ğŸ“‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
                    <input
                      type="file"
                      accept=".json"
                      multiple
                      className="hidden"
                      onChange={(e) => importBackup(e.target.files)}
                    />
                  </label>
                  <p className="text-xs text-slate-400 mt-2">åˆ¥ã®PCãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç§»è¡Œã™ã‚‹å ´åˆã«ä½¿ç”¨</p>
                </div>
              )}
            </div>

            {hasData && (
              <>
                {/* ã‚¿ãƒ– */}
                <div className="flex gap-1 mb-6 bg-white rounded-lg p-1 shadow-sm">
                  {[
                    { id: 'overview', label: 'ğŸ“Š æ¦‚è¦' },
                    { id: 'calendar', label: 'ğŸ“… æ±ºç®—' },
                    { id: 'history', label: 'ğŸ“ˆ æ¨ç§»' },
                    { id: 'holdings', label: 'ğŸ“‹ ä¿æœ‰ä¸€è¦§' },
                    { id: 'ai', label: 'ğŸ¤– AIã‚¢ãƒ‰ãƒã‚¤ã‚¹' },
                  ].map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ${
                        activeTab === tab.id ? 'bg-blue-600 text-white' : 'text-slate-600 hover:bg-slate-100'
                      }`}
                    >
                      {tab.label}
                    </button>
                  ))}
                </div>

                {/* æ¦‚è¦ã‚¿ãƒ– */}
                {activeTab === 'overview' && (
                  <div className="space-y-6">
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-6 text-white">
                      <p className="text-blue-100 text-sm">ç·è³‡ç”£è©•ä¾¡é¡</p>
                      <p className="text-4xl font-bold mt-1">Â¥{Math.round(totalValueJPY).toLocaleString()}</p>
                      <div className="flex gap-4 mt-4 text-sm flex-wrap">
                        <div><span className="text-blue-200">ç±³å›½æ ª</span><span className="ml-2 font-medium">Â¥{Math.round(totalUSValueJPY).toLocaleString()}</span></div>
                        <div><span className="text-blue-200">æ—¥æœ¬æ ª</span><span className="ml-2 font-medium">Â¥{Math.round(totalJPValue).toLocaleString()}</span></div>
                        <div><span className="text-blue-200">æŠ•è³‡ä¿¡è¨—</span><span className="ml-2 font-medium">Â¥{Math.round(totalFundValue).toLocaleString()}</span></div>
                        {totalCashValue > 0 && (
                          <div><span className="text-blue-200">å¤–è²¨é ã‚Šé‡‘</span><span className="ml-2 font-medium">Â¥{Math.round(totalCashValue).toLocaleString()}</span></div>
                        )}
                      </div>
                      <p className="text-xs text-blue-200 mt-2">ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ: {exchangeRate} å††/USD</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div className="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-4">è³‡ç”£é…åˆ†</h3>
                        <SimplePieChart data={pieData} />
                      </div>

                      <div className="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-4">ç›´è¿‘ã®æ±ºç®—äºˆå®š</h3>
                        <div className="space-y-3">
                          {stocksWithEarnings.slice(0, 5).map(stock => {
                            const jpInfo = convertToJapanTime(stock.earnings.nextEarnings, stock.earnings.time);
                            return (
                              <div key={stock.ticker} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                                <div className="flex items-center gap-2">
                                  <span className="text-lg">{stock.type === 'US' ? 'ğŸ‡ºğŸ‡¸' : 'ğŸ‡¯ğŸ‡µ'}</span>
                                  <div>
                                    <p className="font-medium text-slate-800">{stock.ticker}</p>
                                    <p className="text-xs text-slate-500">{stock.name}</p>
                                  </div>
                                </div>
                                <div className="text-right">
                                  <p className="text-sm font-medium text-slate-700">{jpInfo.date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })}</p>
                                  <p className="text-xs text-slate-500">{jpInfo.japanTime || ''}</p>
                                </div>
                              </div>
                            );
                          })}
                          {stocksWithEarnings.length === 0 && <p className="text-slate-500 text-sm">æ±ºç®—äºˆå®šã®ã‚ã‚‹éŠ˜æŸ„ã¯ã‚ã‚Šã¾ã›ã‚“</p>}
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* æ±ºç®—ã‚¿ãƒ– */}
                {activeTab === 'calendar' && (
                  <div className="space-y-6">
                    {/* Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é€£æº */}
                    <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100">
                      <div className="flex items-start justify-between gap-4 flex-wrap">
                        <div>
                          <h3 className="font-bold text-slate-800 flex items-center gap-2">
                            <span className="text-2xl">ğŸ“…</span> Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¿½åŠ 
                          </h3>
                          <p className="text-sm text-slate-600 mt-1">ä¿æœ‰éŠ˜æŸ„ã®æ±ºç®—æ—¥ã‚’Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™</p>
                        </div>
                        <button
                          onClick={downloadICS}
                          className="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg shadow-blue-500/25 whitespace-nowrap"
                        >
                          â¬‡ï¸ .icsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </button>
                      </div>
                      
                      <div className="mt-4 flex items-center gap-3">
                        <span className="text-sm text-slate-600">ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼:</span>
                        <select value={reminderDays} onChange={(e) => setReminderDays(parseInt(e.target.value))} className="border border-slate-200 rounded-lg px-3 py-1.5 text-sm bg-white">
                          <option value={1}>1æ—¥å‰</option>
                          <option value={3}>3æ—¥å‰</option>
                          <option value={7}>1é€±é–“å‰</option>
                        </select>
                      </div>

                      <details className="mt-4">
                        <summary className="text-sm text-blue-600 cursor-pointer hover:text-blue-800">ğŸ“– ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ‰‹é †ã‚’è¦‹ã‚‹</summary>
                        <div className="mt-3 bg-white rounded-lg p-4 text-sm text-slate-600 space-y-2">
                          <p><strong>1.</strong> ä¸Šã®ãƒœã‚¿ãƒ³ã§ .ics ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
                          <p><strong>2.</strong> <a href="https://calendar.google.com/calendar/r/settings/export" target="_blank" rel="noopener noreferrer" className="text-blue-600 underline">Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è¨­å®š</a> ã‚’é–‹ã</p>
                          <p><strong>3.</strong> å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€â†’ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã€</p>
                          <p><strong>4.</strong> ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ .ics ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                          <p><strong>5.</strong> ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é¸ã‚“ã§ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯</p>
                          <p className="text-xs text-slate-400 mt-2">ğŸ’¡ æ±ºç®—æ—¥ã«ã¯æ—¥æœ¬æ™‚é–“ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼ˆç±³å›½å¸‚å ´å‰â†’21æ™‚é ƒã€å¸‚å ´å¾Œâ†’ç¿Œæœ6æ™‚åŠé ƒï¼‰</p>
                        </div>
                      </details>
                    </div>

                    {/* æ±ºç®—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§ */}
                    <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                      <div className="p-4 border-b border-slate-200">
                        <h3 className="font-bold text-slate-800">ğŸ“Š æ±ºç®—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h3>
                      </div>
                      <div className="divide-y divide-slate-100">
                      {stocksWithEarnings.map(stock => {
                        const jpInfo = convertToJapanTime(stock.earnings.nextEarnings, stock.earnings.time);
                        const now = new Date();
                        const daysUntil = Math.ceil((jpInfo.date - now) / (1000 * 60 * 60 * 24));
                        const isUpcoming = daysUntil >= 0 && daysUntil <= 7;
                        
                        return (
                          <div key={stock.ticker} className={`p-4 ${isUpcoming ? 'bg-amber-50' : ''}`}>
                            <div className="flex items-center justify-between">
                              <div className="flex items-center gap-3">
                                <span className="text-2xl">{stock.type === 'US' ? 'ğŸ‡ºğŸ‡¸' : 'ğŸ‡¯ğŸ‡µ'}</span>
                                <div>
                                  <p className="font-bold text-slate-800">{stock.ticker}</p>
                                  <p className="text-sm text-slate-500">{stock.name}</p>
                                </div>
                              </div>
                              <div className="text-right">
                                <p className={`font-medium ${isUpcoming ? 'text-amber-600' : 'text-slate-700'}`}>
                                  ğŸ‡¯ğŸ‡µ {jpInfo.date.toLocaleDateString('ja-JP', { month: 'long', day: 'numeric' })}
                                  {jpInfo.japanTime && <span className="text-xs ml-1">({jpInfo.japanTime})</span>}
                                </p>
                                {daysUntil >= 0 && <p className={`text-xs ${isUpcoming ? 'text-amber-500 font-medium' : 'text-slate-400'}`}>{daysUntil === 0 ? 'ä»Šæ—¥ï¼' : `ã‚ã¨${daysUntil}æ—¥`}</p>}
                                <p className="text-xs text-slate-400 mt-0.5">ğŸ‡ºğŸ‡¸ {stock.earnings.nextEarnings} {stock.earnings.time}</p>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                      {stocksWithEarnings.length === 0 && <div className="p-8 text-center text-slate-500">æ±ºç®—äºˆå®šã®ã‚ã‚‹éŠ˜æŸ„ãŒã‚ã‚Šã¾ã›ã‚“</div>}
                      </div>
                    </div>
                  </div>
                )}

                {/* æ¨ç§»ã‚¿ãƒ– */}
                {activeTab === 'history' && (
                  <div className="space-y-6">
                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                      <h3 className="font-bold text-slate-800 mb-4">ğŸ“ˆ è³‡ç”£æ¨ç§»ï¼ˆéå»30æ—¥ï¼‰</h3>
                      <SimpleLineChart data={chartData} />
                    </div>

                    {history.length > 0 && (
                      <div className="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 className="font-bold text-slate-800 mb-4">ä¿å­˜å±¥æ­´</h3>
                        <div className="space-y-2 max-h-64 overflow-y-auto">
                          {history.slice().reverse().slice(0, 10).map((h, i) => (
                            <div key={i} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                              <span className="text-sm text-slate-600">{h.date}</span>
                              <span className="font-medium text-slate-800">Â¥{Math.round(h.totalValueJPY).toLocaleString()}</span>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {/* ä¿æœ‰ä¸€è¦§ã‚¿ãƒ– */}
                {activeTab === 'holdings' && (
                  <div className="space-y-6">
                    {/* è‡ªå‹•ä¿å­˜ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ */}
                    <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-100">
                      <div className="flex items-start justify-between gap-4 flex-wrap">
                        <div>
                          <h3 className="font-bold text-slate-800 flex items-center gap-2">
                            <span className="text-2xl">âœ…</span> è‡ªå‹•ä¿å­˜
                          </h3>
                          <p className="text-sm text-slate-600 mt-1">CSVã‚’èª­ã¿è¾¼ã‚€ã¨è‡ªå‹•ã§ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™</p>
                          {lastSaved && (
                            <p className="text-xs text-green-600 mt-2">
                              æœ€çµ‚ä¿å­˜: {new Date(lastSaved).toLocaleString('ja-JP')}
                            </p>
                          )}
                          {history.length > 0 && (
                            <p className="text-xs text-slate-500 mt-1">ğŸ“Š {history.length}æ—¥åˆ†ã®å±¥æ­´ã‚ã‚Š</p>
                          )}
                        </div>
                        <div className="text-4xl">ğŸ’¾</div>
                      </div>
                    </div>
                    
                    {/* ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— */}
                    <div className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-100">
                      <h3 className="font-bold text-slate-800 flex items-center gap-2 mb-4">
                        <span className="text-2xl">ğŸ“¦</span> ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒ
                      </h3>
                      <p className="text-sm text-slate-600 mb-4">PCç§»è¡Œã‚„ãƒ–ãƒ©ã‚¦ã‚¶å¤‰æ›´æ™‚ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨</p>
                      
                      <div className="grid md:grid-cols-2 gap-4">
                        {/* ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ */}
                        <div className="bg-white rounded-xl p-4 border border-slate-200">
                          <h4 className="font-medium text-slate-700 mb-2">ğŸ“¥ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</h4>
                          <p className="text-xs text-slate-500 mb-3">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</p>
                          <button
                            onClick={downloadBackup}
                            disabled={!hasData}
                            className={`w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${hasData ? 'bg-gradient-to-r from-amber-500 to-orange-500 text-white hover:from-amber-600 hover:to-orange-600 shadow-lg shadow-amber-500/25' : 'bg-slate-200 text-slate-400 cursor-not-allowed'}`}
                          >
                            ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                          </button>
                        </div>
                        
                        {/* ã‚¤ãƒ³ãƒãƒ¼ãƒˆ */}
                        <div className="bg-white rounded-xl p-4 border border-slate-200">
                          <h4 className="font-medium text-slate-700 mb-2">ğŸ“¤ å¾©å…ƒ</h4>
                          <p className="text-xs text-slate-500 mb-3">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¾©å…ƒ</p>
                          <label className="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-white border-2 border-dashed border-amber-300 hover:border-amber-400 hover:bg-amber-50 text-amber-700 cursor-pointer transition-all">
                            ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                            <input
                              type="file"
                              accept=".json"
                              multiple
                              className="hidden"
                              onChange={(e) => importBackup(e.target.files)}
                            />
                          </label>
                        </div>
                      </div>
                    </div>

                    {usStocks.length > 0 && (
                      <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                        <div className="p-4 border-b border-slate-200 bg-blue-50">
                          <h3 className="font-bold text-blue-800">ğŸ‡ºğŸ‡¸ ç±³å›½æ ªï¼ˆ{usStocks.length}éŠ˜æŸ„ï¼‰</h3>
                        </div>
                        <div className="divide-y divide-slate-100">
                          {usStocks.map(stock => (
                            <div key={stock.ticker} className="p-4 flex items-center justify-between">
                              <div>
                                <p className="font-bold text-slate-800">{stock.ticker}</p>
                                <p className="text-sm text-slate-500">{stock.name}</p>
                              </div>
                              <div className="text-right">
                                <p className="font-medium text-slate-800">${stock.value.toLocaleString()}</p>
                                <p className={`text-sm ${stock.gainPercent >= 0 ? 'text-green-600' : 'text-red-600'}`}>{stock.gainPercent >= 0 ? '+' : ''}{stock.gainPercent}%</p>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {jpStocks.length > 0 && (
                      <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                        <div className="p-4 border-b border-slate-200 bg-red-50">
                          <h3 className="font-bold text-red-800">ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ ªï¼ˆ{jpStocks.length}éŠ˜æŸ„ï¼‰</h3>
                        </div>
                        <div className="divide-y divide-slate-100">
                          {jpStocks.map(stock => (
                            <div key={stock.ticker} className="p-4 flex items-center justify-between">
                              <div>
                                <p className="font-bold text-slate-800">{stock.ticker}</p>
                                <p className="text-sm text-slate-500">{stock.name}</p>
                              </div>
                              <div className="text-right">
                                <p className="font-medium text-slate-800">Â¥{stock.value.toLocaleString()}</p>
                                <p className={`text-sm ${stock.gainPercent >= 0 ? 'text-green-600' : 'text-red-600'}`}>{stock.gainPercent >= 0 ? '+' : ''}{stock.gainPercent}%</p>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {funds.length > 0 && (
                      <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                        <div className="p-4 border-b border-slate-200 bg-green-50">
                          <h3 className="font-bold text-green-800">ğŸ“Š æŠ•è³‡ä¿¡è¨—ï¼ˆ{funds.length}æœ¬ï¼‰</h3>
                        </div>
                        <div className="divide-y divide-slate-100">
                          {funds.map((fund, i) => (
                            <div key={i} className="p-4 flex items-center justify-between">
                              <div className="flex-1 min-w-0 mr-4">
                                <p className="font-bold text-slate-800 truncate">{fund.name}</p>
                                <p className="text-xs text-slate-500">{fund.section}</p>
                              </div>
                              <div className="text-right flex-shrink-0">
                                <p className="font-medium text-slate-800">Â¥{fund.value.toLocaleString()}</p>
                                <p className={`text-sm ${fund.gainPercent >= 0 ? 'text-green-600' : 'text-red-600'}`}>{fund.gainPercent >= 0 ? '+' : ''}{fund.gainPercent}%</p>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {foreignCash.length > 0 && (
                      <div className="bg-white rounded-2xl shadow-sm overflow-hidden">
                        <div className="p-4 border-b border-slate-200 bg-amber-50">
                          <h3 className="font-bold text-amber-800">ğŸ’° å¤–è²¨é ã‚Šé‡‘ï¼ˆ{foreignCash.length}é€šè²¨ï¼‰</h3>
                        </div>
                        <div className="divide-y divide-slate-100">
                          {foreignCash.map((cash, i) => (
                            <div key={i} className="p-4 flex items-center justify-between">
                              <div>
                                <p className="font-bold text-slate-800">{cash.name}</p>
                                <p className="text-xs text-slate-500">{cash.balanceLocal}</p>
                              </div>
                              <div className="text-right">
                                <p className="font-medium text-slate-800">Â¥{cash.value.toLocaleString()}</p>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>
                )}

                {/* AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¿ãƒ– */}
                {activeTab === 'ai' && (
                  <div className="space-y-6">
                    {/* æŠ•è³‡å®¶ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰ */}
                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                      <div className="flex items-center justify-between mb-4">
                        <h3 className="font-bold text-slate-800">ğŸ‘¤ ã‚ãªãŸã®æƒ…å ±</h3>
                        <button onClick={saveProfile} className="text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg transition-colors">
                          ğŸ’¾ ä¿å­˜
                        </button>
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-sm text-slate-600 mb-1">å¹´é½¢</label>
                          <input type="text" value={profile.age} onChange={e => setProfile({...profile, age: e.target.value})} placeholder="ä¾‹: 35æ­³" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm" />
                        </div>
                        <div>
                          <label className="block text-sm text-slate-600 mb-1">æŠ•è³‡ç›®çš„</label>
                          <select value={profile.purpose} onChange={e => setProfile({...profile, purpose: e.target.value})} className="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm">
                            <option>è€å¾Œè³‡é‡‘</option>
                            <option>ä½å®…è³¼å…¥</option>
                            <option>æ•™è‚²è³‡é‡‘</option>
                            <option>FIREãƒ»æ—©æœŸé€€è·</option>
                            <option>è³‡ç”£å½¢æˆ</option>
                            <option>ãã®ä»–</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm text-slate-600 mb-1">ãƒªã‚¹ã‚¯è¨±å®¹åº¦</label>
                          <select value={profile.riskTolerance} onChange={e => setProfile({...profile, riskTolerance: e.target.value})} className="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm">
                            <option value="ä½">ä½ï¼ˆ-10%ã§ä¸å®‰ï¼‰</option>
                            <option value="ä¸­">ä¸­ï¼ˆ-20%ã¾ã§è€ãˆã‚‰ã‚Œã‚‹ï¼‰</option>
                            <option value="é«˜">é«˜ï¼ˆ-30%ä»¥ä¸Šã§ã‚‚ç¶™ç¶šï¼‰</option>
                          </select>
                        </div>
                      </div>
                      <div className="mt-4">
                        <label className="block text-sm text-slate-600 mb-1">è³ªå•ãƒ»ç›¸è«‡ã—ãŸã„ã“ã¨</label>
                        <textarea value={profile.concerns} onChange={e => setProfile({...profile, concerns: e.target.value})} placeholder="ä¾‹: ç±³å›½æ ªæ¯”ç‡ãŒé«˜ã™ãã‚‹ï¼Ÿ ãƒªãƒãƒ©ãƒ³ã‚¹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ï¼Ÿ" className="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm h-20 resize-none" />
                      </div>
                    </div>

                    {/* ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ—é¸æŠ */}
                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                      <h3 className="font-bold text-slate-800 mb-4">ğŸ“‹ ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®ç¨®é¡</h3>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                        {[
                          { id: 'short', label: 'ğŸ“… çŸ­æœŸ', desc: '1ãƒ¶æœˆä»¥å†…' },
                          { id: 'medium', label: 'ğŸ“† ä¸­æœŸ', desc: '3ã€œ6ãƒ¶æœˆ' },
                          { id: 'long', label: 'ğŸ“ˆ é•·æœŸ', desc: '1å¹´ä»¥ä¸Š' },
                          { id: 'balanced', label: 'âš–ï¸ ç·åˆ', desc: 'å…¨æœŸé–“ãƒãƒ©ãƒ³ã‚¹' },
                        ].map(type => (
                          <button
                            key={type.id}
                            onClick={() => setAdviceType(type.id)}
                            className={`p-4 rounded-xl border-2 transition-all text-left ${adviceType === type.id ? 'border-blue-500 bg-blue-50' : 'border-slate-200 hover:border-slate-300'}`}
                          >
                            <div className="font-medium text-slate-800">{type.label}</div>
                            <div className="text-xs text-slate-500">{type.desc}</div>
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ */}
                    <div className="bg-white rounded-2xl p-6 shadow-sm">
                      <div className="flex items-center justify-between mb-4">
                        <h3 className="font-bold text-slate-800">ğŸ“¤ AIã«é€ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h3>
                        <button
                          onClick={() => {
                            const prompt = generateAIPrompt();
                            navigator.clipboard.writeText(prompt);
                            alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\nClaudeã€ChatGPTã€Geminiãªã©ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
                          }}
                          className="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg shadow-blue-500/25"
                        >
                          ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¦AIã«è³ªå•
                        </button>
                      </div>
                      <div className="bg-slate-50 rounded-lg p-4 max-h-96 overflow-y-auto">
                        <pre className="text-xs text-slate-700 whitespace-pre-wrap font-mono">{generateAIPrompt()}</pre>
                      </div>
                      <div className="mt-4 flex gap-2 flex-wrap">
                        <a href="https://claude.ai" target="_blank" rel="noopener noreferrer" className="text-xs bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full hover:bg-orange-200 transition-colors">ğŸŸ  Claude ã§é–‹ã</a>
                        <a href="https://chat.openai.com" target="_blank" rel="noopener noreferrer" className="text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-full hover:bg-emerald-200 transition-colors">ğŸŸ¢ ChatGPT ã§é–‹ã</a>
                        <a href="https://gemini.google.com" target="_blank" rel="noopener noreferrer" className="text-xs bg-blue-100 text-blue-700 px-3 py-1.5 rounded-full hover:bg-blue-200 transition-colors">ğŸ”µ Gemini ã§é–‹ã</a>
                      </div>
                    </div>
                  </div>
                )}
              </>
            )}

            {!hasData && (
              <div className="bg-white rounded-2xl p-8 shadow-sm">
                <h3 className="font-bold text-slate-800 mb-4">ğŸ“– ä½¿ã„æ–¹</h3>
                <ol className="space-y-3 text-sm text-slate-600">
                  <li className="flex gap-3"><span className="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">1</span><span>æ¥½å¤©è¨¼åˆ¸ã«ãƒ­ã‚°ã‚¤ãƒ³ â†’ ã€Œä¿æœ‰å•†å“ä¸€è¦§ã€ã‚’é–‹ã</span></li>
                  <li className="flex gap-3"><span className="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">2</span><span>ã€Œç±³å›½æ ªå¼ã€ã€Œæ—¥æœ¬æ ªå¼ã€ã€ŒæŠ•è³‡ä¿¡è¨—ã€ãã‚Œãã‚Œã§ã€ŒCSVä¿å­˜ã€</span></li>
                  <li className="flex gap-3"><span className="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">3</span><span>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸCSVã‚’ã¾ã¨ã‚ã¦ä¸Šã®ã‚¨ãƒªã‚¢ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</span></li>
                  <li className="flex gap-3"><span className="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold">4</span><span>æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¯è‡ªå‹•ã§ãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã•ã‚Œã¾ã™</span></li>
                </ol>
                <div className="mt-6 p-4 bg-green-50 rounded-lg">
                  <p className="text-sm text-green-700">âœ… <strong>è‡ªå‹•ä¿å­˜</strong>ï¼šCSVèª­ã¿è¾¼ã¿å¾Œã€è‡ªå‹•ã§ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«è‡ªå‹•å¾©å…ƒï¼</p>
                </div>
                <div className="mt-3 p-4 bg-amber-50 rounded-lg">
                  <p className="text-sm text-amber-700">ğŸ’¡ <strong>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</strong>ï¼šã€Œä¿æœ‰ä¸€è¦§ã€ã‚¿ãƒ–ã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼ˆPCç§»è¡Œæ™‚ãªã©ã«ä¾¿åˆ©ï¼‰</p>
                </div>
              </div>
            )}
          </main>

          <footer className="bg-white border-t border-slate-200 mt-8">
            <div className="max-w-6xl mx-auto px-4 py-4 text-center text-xs text-slate-500">
              <p>æ¥½å¤©è¨¼åˆ¸å¯¾å¿œ è³‡ç”£ç®¡ç†ï¼†æ±ºç®—ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ v5.1.0</p>
              <p className="mt-1">ğŸ”’ ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã•ã‚Œã¾ã™ï¼ˆã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—ï¼‰</p>
            </div>
          </footer>
        </div>
      );
    }

    // Reactã‚¢ãƒ—ãƒªã‚’ãƒã‚¦ãƒ³ãƒˆ
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
